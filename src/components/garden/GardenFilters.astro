---
import '@styles/global.css';
import {
    SORT_LABELS,
    SORT_TYPES,
    getGardenSortUrl,
    getGardenTopicSortUrl,
    type SortType,
    type TopicOption
} from '@utils/garden';

interface Props {
    topics: TopicOption[];
    currentTopic?: string;
    currentSort: SortType;
}

const { topics, currentTopic, currentSort } = Astro.props;
const totalCount = topics.reduce((sum, topic) => sum + topic.count, 0);
---

<div class="sticky top-8 space-y-8">
    <section>
        <h2 class="text-light-tx dark:text-dark-tx mb-4 text-lg font-medium">Topics</h2>
        <nav class="space-y-1">
            <a
                href={getGardenSortUrl(currentSort)}
                class:list={[
                    'block rounded-md px-3 py-2 text-sm transition-all duration-200',
                    'relative overflow-hidden',
                    !currentTopic
                        ? [
                              'bg-light-bl dark:bg-dark-bl',
                              'text-paper dark:text-paper',
                              'font-medium',
                              'border-light-bl dark:border-dark-bl border-l-2'
                          ]
                        : [
                              'text-light-tx-2 dark:text-dark-tx-2',
                              'hover:bg-light-ui dark:hover:bg-dark-ui',
                              'hover:text-light-tx dark:hover:text-dark-tx'
                          ]
                ]}
            >
                All <span class="opacity-70">({totalCount})</span>
            </a>
            {
                topics.map((topic) => (
                    <a
                        href={getGardenTopicSortUrl(topic.slug, currentSort)}
                        class:list={[
                            'block rounded-md px-3 py-2 text-sm transition-all duration-200',
                            'relative overflow-hidden',
                            currentTopic === topic.slug
                                ? [
                                      'bg-light-bl dark:bg-dark-bl',
                                      'text-paper dark:text-paper',
                                      'font-medium',
                                      'border-light-bl dark:border-dark-bl border-l-2'
                                  ]
                                : [
                                      'text-light-tx-2 dark:text-dark-tx-2',
                                      'hover:bg-light-ui dark:hover:bg-dark-ui',
                                      'hover:text-light-tx dark:hover:text-dark-tx'
                                  ]
                        ]}
                    >
                        {topic.label} <span class="opacity-70">({topic.count})</span>
                    </a>
                ))
            }
        </nav>
    </section>

    <section>
        <h2 class="text-light-tx dark:text-dark-tx mb-4 text-lg font-medium">Sort by</h2>
        <nav class="space-y-1">
            {
                SORT_TYPES.map((sortType) => {
                    const href = currentTopic
                        ? getGardenTopicSortUrl(currentTopic, sortType)
                        : getGardenSortUrl(sortType);
                    const isActive = currentSort === sortType;

                    return (
                        <a
                            href={href}
                            class:list={[
                                'block rounded-md px-3 py-2 text-sm transition-all duration-200',
                                'relative overflow-hidden',
                                isActive
                                    ? [
                                          'bg-light-bl dark:bg-dark-bl',
                                          'text-paper dark:text-paper',
                                          'font-medium',
                                          'border-light-bl dark:border-dark-bl border-l-2'
                                      ]
                                    : [
                                          'text-light-tx-2 dark:text-dark-tx-2',
                                          'hover:bg-light-ui dark:hover:bg-dark-ui',
                                          'hover:text-light-tx dark:hover:text-dark-tx'
                                      ]
                            ]}
                        >
                            {SORT_LABELS[sortType]}
                        </a>
                    );
                })
            }
        </nav>
    </section>
</div>
